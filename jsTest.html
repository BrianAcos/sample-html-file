<!DOCTYPE html>
<html lang="en">

<head>
    <title>JS Samples</title>
    <meta charset="utf-8">
    <meta name="keywords" content="sample,html,file">
    <meta name="description" content="This is a sample html file">
    <style>
        table thead tr th {
            background-color: #ddd;
            padding: 5px;
        }

        table tbody tr td {
            border-bottom: 1px solid black;
            padding: 5px;
        }

        .totals {
            margin-top: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            width: 345px;
            font-size: 1.2rem;
        }

        .totals .label {
            font-weight: bold;
            text-align: right;
            padding-right: 10px;
        }

        .price::before {
            content: '$ ';
        }
    </style>
</head>

<body>
    <h1>Shopping Cart</h1>
    <table id="products-list">
        <thead>
            <tr>
                <th>
                    Product
                </th>
                <th>
                    Unit. Price
                </th>
                <th>
                    Quantity
                </th>
                <th>
                    Subtotal
                </th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>

    <div class="totals">
        <div class="label">Subtotal</div>
        <div class="price subtotal"></div>
        <div class="label">Discount</div>
        <div class="price discount"></div>
        <div class="label">Taxes</div>
        <div class="price taxes"></div>
        <div class="label">Total</div>
        <div class="price total"></div>
    </div>

    <script>
        var products = [
            {
                name: "Tomato",
                price: 19,
                quantity: 2
            },
            {
                name: "Potato",
                price: 16,
                quantity: 4
            },
            {
                name: "Milk",
                price: 32,
                quantity: 2
            }
        ];

        // Agregar producto a la cansta 
        products.push({
            name: 'Cookies',
            price: 46,
            quantity: 3
        });

        //Ordenar alfabeticamente productos de la canasta 
        products.sort(function (a, b) {
            var nameA = a.name.toUpperCase(); // ignore upper and lowercase
            var nameB = b.name.toUpperCase(); // ignore upper and lowercase
            if (nameA < nameB) {
                return -1;
            }
            if (nameA > nameB) {
                return 1;
            }

            // names must be equal
            return 0;
        });

        const createCellWithText = (text) => {
            var cell = document.createElement("td");
            var cellText = document.createTextNode(text);
            cell.appendChild(cellText);
            return cell;
        }

        const drawTable = () => {
            // Gets products-list tbody element reference and store it on a variable.
            const tableBody = document.querySelector('#products-list tbody');
            products.forEach(product => {
                var row = document.createElement("tr");
                const nameCell = createCellWithText(product.name);
                row.appendChild(nameCell);
                const priceCell = createCellWithText(product.price);
                row.appendChild(priceCell);
                const quantityCell = createCellWithText(product.quantity);
                row.appendChild(quantityCell);
                const subtotalCell = createCellWithText(product.quantity * product.price);
                row.appendChild(subtotalCell);
                tableBody.appendChild(row);
            });
        }

        // Calcular el subtotal sumando todos los productos
        var SubTotalTodosLosProductos = 0;
        const calculateSubTotal = () => {
            products.forEach((productos) => SubTotalTodosLosProductos = SubTotalTodosLosProductos + (productos.price * productos.quantity));
            return SubTotalTodosLosProductos;
        };

        //Calacular cantidad de productos
        var cantidadProductos = 0;
        products.forEach((cantidad) => cantidadProductos = cantidadProductos + cantidad.quantity);
        console.log(cantidadProductos);

        //Metodo para el descuento del subtotal
        const calculateDiscount = (subtotal) => {
            if (cantidadProductos > 5) {
                return Math.round(subtotal * 0.15 * 10) / 10;
            } else if (subtotal >= 100) {
                return Math.round(subtotal * 0.1 * 10) / 10;
            } else {
                return Math.round(subtotal * 0.05 * 10) / 10;
            }
        }

        const TAXES = 0.24;
        const drawTotals = () => {
            const subTotal = calculateSubTotal();
            const discount = calculateDiscount(subTotal);
            const taxes = Math.round((subTotal - discount) * TAXES * 10) / 10;
            const total = subTotal - discount + taxes;
            document.querySelector('.totals .subtotal').textContent = subTotal;
            document.querySelector('.totals .discount').textContent = discount;
            document.querySelector('.totals .taxes').textContent = taxes;
            document.querySelector('.totals .total').textContent = total;
        }
        const start = () => {
            drawTable();
            drawTotals();
        }
        start();
    </script>
</body>

</html>